# -----------------------------------------------------------------------------
# ChordAtlas Frontend Image NGINX Configuration
# -----------------------------------------------------------------------------
# Purpose:
#   Used inside the production frontend image (amohall/chordatlas-frontend).
#   This NGINX instance serves static files (React build output) and proxies
#   /api requests to the running backend container.
#
# Behavior:
#   • Serves static assets from /usr/share/nginx/html (the built frontend).
#   • Routes any /api/* request to chordatlas-backend:5000.
#   • Preserves client headers (X-Forwarded-For, X-Real-IP, etc.).
#
# Integration with Makefile:
#   This config is used automatically when `make prod` runs and the
#   frontend image is launched from docker-compose.yml.
#   No manual setup required in production deployments.
# -----------------------------------------------------------------------------

server {
    listen 80;
    server_name _;

    root /usr/share/nginx/html;
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }

    location /api/ {
        proxy_pass http://chordatlas-backend:5000/api/;
        proxy_http_version 1.1;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
